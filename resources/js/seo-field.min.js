var SeoField=function(e,t){var i=this;this.namespace=e,this.readabilityFields=t,this.title(),this.slug(),this.desc(),this.keyword=document.getElementById(e+"-keyword"),this.keyword.addEventListener("change",function(){i.keywordListener()}),this.score=document.getElementById(e+"-score"),this.toggle(),this.calculateScore()};SeoField.prototype.title=function(){var e,t,i=this.titleField=document.getElementById(this.namespace+"-title"),s=document.getElementById("title"),o=this;if(e=function(){i.value=this.value+" "+n},t=function(){this.classList.remove("clean"),s.removeEventListener("input",e,!1),this.removeEventListener("input",t,!1)},s&&i.classList.contains("clean")){var n=i.value;s.addEventListener("input",e,!1)}i.addEventListener("input",t,!1),i.addEventListener("change",function(){o.calculateScore()})},SeoField.prototype.slug=function(){var e=this.slugField=document.getElementById(this.namespace+"-slug"),t=document.getElementById("slug"),i=document.getElementById(this.namespace+"-ref"),s=this;t&&e&&(e.textContent=t.value,i.textContent=i.textContent.replace(t.value,""),setInterval(function(){e.textContent!==t.value&&(e.textContent=t.value,s.calculateScore())},1e3))},SeoField.prototype.desc=function(){function e(){t.oninput()}var t=this.descField=document.getElementById(this.namespace+"-description"),i=this;setTimeout(function(){e()},1),Craft.livePreview.on("enter",e),Craft.livePreview.on("exit",e),window.addEventListener("resize",e),t.addEventListener("keydown",function(e){13===e.keyCode&&e.preventDefault()}),t.addEventListener("input",function(){this.value=this.value.replace(/(\r\n|\n|\r)/gm," "),this.value.length>160?this.classList.add("invalid"):this.classList.remove("invalid")}),t.addEventListener("change",function(){i.calculateScore()})},SeoField.prototype.keywordListener=function(){this.calculateScore()},SeoField.prototype.toggle=function(){var e=this,t=!1;this.score.getElementsByClassName("toggle-score")[0].addEventListener("click",function(){e.score.classList.toggle("open"),t=!t,t?e.score.getElementsByClassName("details")[0].style.height=e.score.getElementsByClassName("details-inner")[0].clientHeight+"px":e.score.getElementsByClassName("details")[0].style.height=""})},SeoField.prototype.moveItems=function(e){var t=[].slice.call(this.score.getElementsByClassName("item")),i=this.score.querySelectorAll(".details li");[].slice.call(i).forEach(function(i){var s=i.getAttribute("data-i");e?(t[s].style.left=i.offsetLeft+"px",t[s].style.top=i.offsetTop+"px"):(t[s].style.left=s*(100/t.length)+"%",t[s].style.top="")})},SeoField.prototype.calculateScore=function(){if(this.keyword.value){this.currentScore={};var e=this;this.currentScore.titleLength=this.judgeTitleLength(),this.currentScore.titleKeyword=this.judgeTitleKeyword(),this.currentScore.slug=this.judgeSlug(),this.currentScore.desc=this.judgeDesc(),this.readabilityFields.length>0?SeoField.getFieldsHTML(this.readabilityFields,function(t){var i=document.createElement("div");i.innerHTML=t,[].slice.call(i.getElementsByTagName("seo-parse")).forEach(function(e){e.textContent&&"Array"!==e.textContent||i.removeChild(e)}),e.content=i,e.currentScore.wordCount=e.judgeWordCount(),e.currentScore.firstParagraph=e.judgeFirstParagraph(),e.currentScore.images=e.judgeImages(),e.currentScore.links=e.judgeLinks(),e.currentScore.headings=e.judgeHeadings(),e.updateScoreHtml()}):this.updateScoreHtml()}else this.score.classList.remove("open"),this.score.classList.add("disabled")},SeoField.prototype.updateScoreHtml=function(){this.score.classList.remove("disabled");var e=this.score.getElementsByClassName("details-inner")[0];e.innerHTML="";for(var t in this.currentScore)this.currentScore.hasOwnProperty(t)&&this.currentScore[t]&&(e.innerHTML+="<li>"+this.currentScore[t].reason+"</li>")},SeoField.prototype.judgeTitleLength=function(){var e,t=this.titleField.value;return e={score:t.length<40||t.length>60?SeoField.Levels.BAD:SeoField.Levels.GOOD,reason:t.length<40?SeoField.Reasons.titleLengthFailMin:t.length>60?SeoField.Reasons.titleLengthFailMax:SeoField.Reasons.titleLengthSuccess},e.reason=e.reason.replace("{l}",t.length),e},SeoField.prototype.judgeTitleKeyword=function(){var e;if(this.titleField.value.indexOf(this.keyword.value)>-1){for(var t=this.titleField.value.split(" "),i=!1,s=0;s<t.length/2;s++)if(t[s]==this.keyword.value){i=!0;break}e=i?{score:SeoField.Levels.GOOD,reason:SeoField.Reasons.titleKeywordSuccess}:{score:SeoField.Levels.OK,reason:SeoField.Reasons.titleKeywordPosFail}}else e={score:SeoField.Levels.BAD,reason:SeoField.Reasons.titleKeywordFail};return e},SeoField.prototype.judgeSlug=function(){return this.slugField?this.slugField.value.indexOf(this.keyword.value)>-1?{score:SeoField.Levels.GOOD,reason:SeoField.Reasons.slugSuccess}:{score:SeoField.Levels.BAD,reason:SeoField.Reasons.slugFail}:void 0},SeoField.prototype.judgeDesc=function(){return this.descField.value.indexOf(this.keyword.value)>-1?{score:SeoField.Levels.GOOD,reason:SeoField.Reasons.descSuccess}:{score:SeoField.Levels.BAD,reason:SeoField.Reasons.descFail}},SeoField.prototype.judgeWordCount=function(){var e=this.content.textContent.trim().replace(/\s+/gi," ").split(" ").length;return e>300?{score:SeoField.Levels.GOOD,reason:SeoField.Reasons.wordCountSuccess.replace("{l}",e)}:{score:SeoField.Levels.BAD,reason:SeoField.Reasons.wordCountFail.replace("{l}",e)}},SeoField.prototype.judgeFirstParagraph=function(){return this.content.querySelector("p").textContent.indexOf(this.keyword.value)>-1?{score:SeoField.Levels.GOOD,reason:SeoField.Reasons.firstParagraphSuccess}:{score:SeoField.Levels.BAD,reason:SeoField.Reasons.firstParagraphFail}},SeoField.prototype.judgeImages=function(){var e=this.content.getElementsByTagName("img");if(e){for(var t=0,i=0;i<e.length;i++)e[i].getAttribute("alt")&&e[i].getAttribute("alt").indexOf(this.keyword.value)&&t++;return t===e.length?{score:SeoField.Levels.GOOD,reason:SeoField.Reasons.imagesSuccess}:t>=e.length/2?{score:SeoField.Levels.OK,reason:SeoField.Reasons.imagesOk}:{score:SeoField.Levels.BAD,reason:SeoField.Reasons.imagesFail}}},SeoField.prototype.judgeLinks=function(){var e=this.content.getElementsByTagName("a");if(e)for(var t=0;t<e.length;t++)if(SeoField.isExternalUrl(e[t].href))return{score:SeoField.Levels.GOOD,reason:SeoField.Reasons.linksSuccess};return{score:SeoField.Levels.BAD,reason:SeoField.Reasons.linksFail}},SeoField.prototype.judgeHeadings=function(){var e=this.content.querySelectorAll("h1,h2,h3,h4,h5,h6");if(e){for(var t=0,i=0,s=0;s<e.length;s++)e[s].textContent.indexOf(this.keyword.value)>-1&&(["H1","H2"].indexOf(e[s].nodeName)>-1?t++:i++);if(t>0)return{score:SeoField.Levels.GOOD,reason:SeoField.Reasons.headingsSuccess};if(i>0)return{score:SeoField.Levels.OK,reason:SeoField.Reasons.headingsOk}}return{score:SeoField.Levels.BAD,reason:SeoField.Reasons.headingsFail}},SeoField.getFieldsHTML=function(e,t){for(var i={},s=0;s<e.length;s++)[].slice.call(document.forms[0].elements).forEach(function(e){i[e.getAttribute("name")]=e.value});Craft.postActionRequest("seo/parser?fields="+e.join(","),i,function(e){t(e)})},SeoField.isExternalUrl=function(){var e=/https?:\/\/((?:[\w\d]+\.)+[\w\d]{2,})/i;return function(t){function i(t){return e.exec(t)[1]}return i(location.href)!==i(t)}}(),SeoField.Levels={NONE:0,GOOD:1,OK:2,BAD:3},SeoField.Reasons={titleLengthFailMin:"The title contains {l} characters which is less than the recommended minimum of 40 characters.",titleLengthFailMax:"The title contains {l} characters which is greater than the recommended maximum of 60 characters.",titleLengthSuccess:"The title is between the recommended minimum and maximum length.",titleKeywordFail:"The title does not contain the keyword. Try adding it near the beginning of the title.",titleKeywordSuccess:"The title contains the keyword near the beginning.",titleKeywordPosFail:"The title contains the keyword, but not near the beginning. Try to move it closer to the start of the title.",slugFail:"The URL does not contain the keyword. Try adding it to the slug.",slugSuccess:"The URL contains the keyword.",descFail:"The description does not contain the keyword. Try adding it near the beginning of the description.",descSuccess:"The description contains the keyword.",wordCountFail:"Your text contains {l} words, this is less than the recommended 300 word minimum.",wordCountSuccess:"Your text contains {l} words, this is more than the recommended 300 word minimum.",firstParagraphFail:"The keyword does not appear in the first paragraph of your text. Try adding it.",firstParagraphSuccess:"The keyword appears in the first paragraph of your text.",imagesFail:"Less than half of the images have alt tags containing the keyword, try adding it to more images.",imagesOk:"Half or more of the images have alt tags containing the keyword. To improve this, try adding keywords to all the images alt tags.",imagesSuccess:"All of the images have alt tags containing the keyword.",linksFail:"The page does not contain any outgoing links. Try adding some.",linksSuccess:"The page contains outgoing links.",headingsFail:"The page does not contain any headings that contain the keyword. Try adding some with the keyword.",headingsOk:"The page contains some lower importance headings that contain the keyword. Try adding the keyword to some h2's.",headingsSuccess:"The page contains higher importance headings with the keyword."};