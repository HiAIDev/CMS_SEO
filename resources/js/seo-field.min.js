var SeoField=function(e,t){var i=this;this.namespace=e,this.readabilityFields=t,this.title(),this.slug(),this.desc(),this.keyword=document.getElementById(e+"-keyword"),this.keyword.addEventListener("change",function(){i.keywordListener()}),this.score=document.getElementById(e+"-score"),this.toggle(),this.calculateScore()};SeoField.prototype.title=function(){var e,t,i=this.titleField=document.getElementById(this.namespace+"-title"),s=document.getElementById("title"),n=this;if(e=function(){i.value=this.value+" "+l},t=function(){this.classList.remove("clean"),s.removeEventListener("input",e,!1),this.removeEventListener("input",t,!1)},s&&i.classList.contains("clean")){var l=i.value;s.addEventListener("input",e,!1)}i.addEventListener("input",t,!1),i.addEventListener("change",function(){n.calculateScore()})},SeoField.prototype.slug=function(){var e=this.slugField=document.getElementById(this.namespace+"-slug"),t=document.getElementById("slug"),i=document.getElementById(this.namespace+"-ref"),s=this;t&&e&&(e.textContent=t.value,i.textContent=i.textContent.replace(t.value,""),setInterval(function(){e.textContent!==t.value&&(e.textContent=t.value,s.calculateScore())},1e3))},SeoField.prototype.desc=function(){function e(){t.oninput()}var t=this.descField=document.getElementById(this.namespace+"-description"),i=this;setTimeout(function(){e()},1),Craft.livePreview.on("enter",e),Craft.livePreview.on("exit",e),window.addEventListener("resize",e),t.addEventListener("keydown",function(e){13===e.keyCode&&e.preventDefault()}),t.addEventListener("input",function(){this.value=this.value.replace(/(\r\n|\n|\r)/gm," "),this.value.length>160?this.classList.add("invalid"):this.classList.remove("invalid")}),t.addEventListener("change",function(){i.calculateScore()})},SeoField.prototype.keywordListener=function(){this.calculateScore()},SeoField.prototype.toggle=function(){var e=this,t=!1;this.score.getElementsByClassName("toggle-score")[0].addEventListener("click",function(){e.score.classList.toggle("open"),t=!t,t?e.score.getElementsByClassName("details")[0].style.height=e.score.getElementsByClassName("details-inner")[0].clientHeight+"px":e.score.getElementsByClassName("details")[0].style.height=""})},SeoField.prototype.moveItems=function(e){var t=[].slice.call(this.score.getElementsByClassName("item")),i=this.score.querySelectorAll(".details li");[].slice.call(i).forEach(function(i){var s=i.getAttribute("data-i");e?(t[s].style.left=i.offsetLeft+"px",t[s].style.top=i.offsetTop+"px"):(t[s].style.left=s*(100/t.length)+"%",t[s].style.top="")})},SeoField.prototype.calculateScore=function(){if(this.keyword.value){var e={};e.titleLength=this.judgeTitleLength(),e.titleKeyword=this.judgeTitleKeyword(),e.slug=this.judgeSlug(),e.desc=this.judgeDesc(),this.readabilityFields.length>0&&SeoField.getFieldsHTML(this.readabilityFields,function(e){console.log(e)}),this.score.classList.remove("disabled");var t=this.score.getElementsByClassName("details-inner")[0];t.innerHTML="";for(var i in e)e.hasOwnProperty(i)&&e[i]&&(t.innerHTML+="<li>"+e[i].reason+"</li>")}else this.score.classList.remove("open"),this.score.classList.add("disabled")},SeoField.prototype.judgeTitleLength=function(){var e,t=this.titleField.value;return e={score:t.length<40||t.length>60?SeoField.Levels.BAD:SeoField.Levels.GOOD,reason:t.length<40?SeoField.Reasons.titleLengthFailMin:t.length>60?SeoField.Reasons.titleLengthFailMax:SeoField.Reasons.titleLengthSuccess},e.reason=e.reason.replace("{l}",t.length),e},SeoField.prototype.judgeTitleKeyword=function(){var e;if(this.titleField.value.indexOf(this.keyword.value)>-1){for(var t=this.titleField.value.split(" "),i=!1,s=0;s<t.length/2;s++)if(t[s]==this.keyword.value){i=!0;break}e=i?{score:SeoField.Levels.GOOD,reason:SeoField.Reasons.titleKeywordSuccess}:{score:SeoField.Levels.OK,reason:SeoField.Reasons.titleKeywordPosFail}}else e={score:SeoField.Levels.BAD,reason:SeoField.Reasons.titleKeywordFail};return e},SeoField.prototype.judgeSlug=function(){return this.slugField?this.slugField.value.indexOf(this.keyword.value)>-1?{score:SeoField.Levels.GOOD,reason:SeoField.Reasons.slugSuccess}:{score:SeoField.Levels.BAD,reason:SeoField.Reasons.slugFail}:void 0},SeoField.prototype.judgeDesc=function(){return this.descField.value.indexOf(this.keyword.value)>-1?{score:SeoField.Levels.GOOD,reason:SeoField.Reasons.descSuccess}:{score:SeoField.Levels.BAD,reason:SeoField.Reasons.descFail}},SeoField.stripHTML=function(e){var t=document.createElement("DIV");return t.innerHTML=e,console.log(t.querySelectorAll("a")),t.textContent||t.innerText||""},SeoField.getFieldsHTML=function(e,t){for(var i={},s=0;s<e.length;s++)[].slice.call(document.forms[0].elements).forEach(function(e){i[e.getAttribute("name")]=e.value});Craft.postActionRequest("seo/parser?fields="+e.join(","),i,function(e){t(e)})},SeoField.Levels={NONE:0,GOOD:1,OK:2,BAD:3},SeoField.Reasons={titleLengthFailMin:"The title contains {l} characters which is less than the recommended minimum of 40 characters.",titleLengthFailMax:"The title contains {l} characters which is greater than the recommended maximum of 60 characters.",titleLengthSuccess:"The title is between the recommended minimum and maximum length.",titleKeywordFail:"The title does not contain the keyword. Try adding it near the beginning of the title.",titleKeywordSuccess:"The title contains the keyword near the beginning.",titleKeywordPosFail:"The title contains the keyword, but not near the beginning. Try to move it closer to the start of the title.",slugFail:"The URL does not contain the keyword. Try adding it to the slug.",slugSuccess:"The URL contains the keyword.",descFail:"The description does not contain the keyword. Try adding it near the beginning of the description.",descSuccess:"The description contains the keyword."};