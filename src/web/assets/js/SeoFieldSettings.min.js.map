{"version":3,"file":"SeoFieldSettings.min.js","sources":["../../../resources/js/SeoFieldSettings.js"],"sourcesContent":["/**\n * SEO Settings\n *\n * @author    Tam McDonald\n * @copyright Ether Creative 2018\n * @link      https://ethercreative.co.uk\n * @package   SEO\n * @since     3.5.0\n */\n\nclass SeoFieldSettings {\n\n\t// Properties\n\t// =========================================================================\n\n\tnamespace = '';\n\n\ttokenRegex = /\\[title]\\[(\\d)].*/g;\n\ttokenList = null;\n\ttokenTemplate = null;\n\n\tconstructor (namespace) {\n\t\tthis.namespace = namespace;\n\t\tif (namespace.substr(-1) !== \"-\")\n\t\t\tthis.namespace += \"-\";\n\n\t\tthis.initSeoTitle();\n\t}\n\n\t// Init / Setup\n\t// =========================================================================\n\n\tinitSeoTitle () {\n\t\tthis.tokenList = this.getElementById(\"seoMetaTitle\");\n\t\tthis.tokenTemplate = this.getElementById(\"seoMetaToken\").content;\n\n\t\tconst existingTokens =\n\t\t\tthis.tokenList.querySelectorAll(\"li:not([data-static])\");\n\t\tlet i = existingTokens.length;\n\t\tif (i > 0) while (i--)\n\t\t\tthis.setupToken(existingTokens[i]);\n\n\t\twindow.addEventListener(\"focus\", this.onFocusChange, true);\n\t\twindow.addEventListener(\"blur\", this.onFocusChange, true);\n\n\t\tthis.getElementById(\"seoMetaAdd\").addEventListener(\n\t\t\t\"click\",\n\t\t\tthis.onAddClick\n\t\t);\n\t}\n\n\tsetupToken (token) {\n\t\tconst tmpl = token.querySelector(\"[data-template]\");\n\t\tSeoFieldSettings.onTemplateInput({ target: tmpl });\n\t\ttmpl.addEventListener(\n\t\t\t\"input\",\n\t\t\tSeoFieldSettings.onTemplateInput\n\t\t);\n\n\t\ttoken.querySelector(\"[data-lock]\").addEventListener(\n\t\t\t\"click\",\n\t\t\tSeoFieldSettings.onLockClick\n\t\t);\n\n\t\ttoken.querySelector(\"[data-delete]\").addEventListener(\n\t\t\t\"click\",\n\t\t\tthis.onDeleteClick\n\t\t);\n\t}\n\n\t// Events\n\t// =========================================================================\n\n\tonFocusChange = () => {\n\t\tif (this.tokenList.contains(document.activeElement))\n\t\t\tthis.tokenList.classList.add(\"focus\");\n\t\telse\n\t\t\tthis.tokenList.classList.remove(\"focus\");\n\t};\n\n\tonAddClick = e => {\n\t\te.preventDefault();\n\t\tconst li = document.importNode(this.tokenTemplate, true);\n\t\tconst indexReplace = li.querySelectorAll(\"[name*='__LOOP_INDEX__']\")\n\t\t\t, index = this.tokenList.children.length - 1;\n\n\t\tlet i = indexReplace.length,\n\t\t\tt = null;\n\t\twhile (i--) {\n\t\t\tconst el = indexReplace[i];\n\t\t\tconst name = el.getAttribute(\"name\");\n\t\t\tel.setAttribute(\n\t\t\t\t\"name\",\n\t\t\t\tname.replace(\"__LOOP_INDEX__\", index)\n\t\t\t);\n\n\t\t\tif (~name.indexOf(\"key\"))\n\t\t\t\tel.value = Math.random().toString(36).substr(2, 3);\n\n\t\t\tif (~name.indexOf(\"template\"))\n\t\t\t\tt = el;\n\t\t}\n\n\t\tthis.setupToken(li);\n\t\tthis.tokenList.insertBefore(li, this.tokenList.lastElementChild);\n\t\tt.focus();\n\t};\n\n\tstatic onTemplateInput (e) {\n\t\tconst value = e.target.value;\n\t\te.target.style.width = `calc(${value.length}ch + 10px)`;\n\t}\n\n\tstatic onLockClick (e) {\n\t\te.preventDefault();\n\t\tconst target = e.target;\n\t\tconst input = target.previousElementSibling;\n\n\t\tif (input.value === \"1\") {\n\t\t\tinput.value = \"0\";\n\t\t\ttarget.setAttribute(\"title\", \"Lock Token\");\n\t\t\ttarget.parentNode.classList.remove(\"locked\");\n\t\t} else {\n\t\t\tinput.value = \"1\";\n\t\t\ttarget.setAttribute(\"title\", \"Unlock Token\");\n\t\t\ttarget.parentNode.classList.add(\"locked\");\n\t\t}\n\t}\n\n\tonDeleteClick = e => {\n\t\te.preventDefault();\n\t\tthis.tokenList.removeChild(e.target.parentNode);\n\t\tthis.reIndexTokens();\n\t};\n\n\t// Helpers\n\t// =========================================================================\n\n\treIndexTokens () {\n\t\tconst tokens = this.tokenList.children;\n\t\tlet i = tokens.length - 1;\n\t\tif (i > 0) while (i--) {\n\t\t\tconst token = tokens[i]\n\t\t\t\t, rpl = SeoFieldSettings.replaceKey.bind(this, i);\n\t\t\tconst inputs = token.getElementsByTagName(\"input\");\n\t\t\tlet x = inputs.length;\n\t\t\twhile (x--) {\n\t\t\t\tinputs[x].setAttribute(\n\t\t\t\t\t\"name\",\n\t\t\t\t\tinputs[x].getAttribute(\"name\").replace(this.tokenRegex, rpl)\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t}\n\n\tstatic replaceKey (i, a, b) {\n\t\treturn a.replace(b, i);\n\t}\n\n\tgetElementById (id) {\n\t\treturn document.getElementById(this.namespace + id);\n\t}\n\n}\n\nwindow.SeoFieldSettings = SeoFieldSettings;"],"names":["SeoFieldSettings","namespace","tokenRegex","tokenList","tokenTemplate","onFocusChange","_this","contains","document","activeElement","classList","add","remove","onAddClick","preventDefault","li","importNode","indexReplace","querySelectorAll","index","children","length","i","t","el","name","getAttribute","setAttribute","replace","indexOf","value","Math","random","toString","substr","setupToken","insertBefore","lastElementChild","focus","onDeleteClick","removeChild","e","target","parentNode","reIndexTokens","this","initSeoTitle","getElementById","content","existingTokens","window","addEventListener","token","tmpl","querySelector","onTemplateInput","onLockClick","tokens","rpl","replaceKey","bind","inputs","getElementsByTagName","x","id","style","width","input","previousElementSibling","a","b"],"mappings":"+WAUMA,uCAWQC,0CANbA,UAAY,QAEZC,WAAa,0BACbC,UAAY,UACZC,cAAgB,UAsDhBC,cAAgB,WACXC,EAAKH,UAAUI,SAASC,SAASC,eACpCH,EAAKH,UAAUO,UAAUC,IAAI,SAE7BL,EAAKH,UAAUO,UAAUE,OAAO,eAGlCC,WAAa,cACVC,yBACIC,EAAKP,SAASQ,WAAWV,EAAKF,eAAe,GAC7Ca,EAAeF,EAAGG,iBAAiB,4BACtCC,EAAQb,EAAKH,UAAUiB,SAASC,OAAS,EAExCC,EAAIL,EAAaI,OACpBE,EAAI,KACED,KAAK,KACLE,EAAKP,EAAaK,GAClBG,EAAOD,EAAGE,aAAa,UAC1BC,aACF,OACAF,EAAKG,QAAQ,iBAAkBT,KAG3BM,EAAKI,QAAQ,SACjBL,EAAGM,MAAQC,KAAKC,SAASC,SAAS,IAAIC,OAAO,EAAG,KAE5CT,EAAKI,QAAQ,cACjBN,EAAIC,KAGDW,WAAWpB,KACXZ,UAAUiC,aAAarB,EAAIT,EAAKH,UAAUkC,oBAC7CC,cAwBHC,cAAgB,cACbzB,mBACGX,UAAUqC,YAAYC,EAAEC,OAAOC,cAC/BC,sBA9GA3C,UAAYA,EACY,MAAzBA,EAAUiC,QAAQ,KACrBW,KAAK5C,WAAa,UAEd6C,+EAOA3C,UAAY0C,KAAKE,eAAe,qBAChC3C,cAAgByC,KAAKE,eAAe,gBAAgBC,YAEnDC,EACLJ,KAAK1C,UAAUe,iBAAiB,yBAC7BI,EAAI2B,EAAe5B,UACnBC,EAAI,EAAG,KAAOA,UACZa,WAAWc,EAAe3B,IAEhC4B,OAAOC,iBAAiB,QAASN,KAAKxC,eAAe,UAC9C8C,iBAAiB,OAAQN,KAAKxC,eAAe,QAE/C0C,eAAe,cAAcI,iBACjC,QACAN,KAAKhC,+CAIKuC,OACLC,EAAOD,EAAME,cAAc,qBAChBC,iBAAkBb,OAAQW,MACtCF,iBACJ,QACAnD,EAAiBuD,mBAGZD,cAAc,eAAeH,iBAClC,QACAnD,EAAiBwD,eAGZF,cAAc,iBAAiBH,iBACpC,QACAN,KAAKN,2DAyEAkB,EAASZ,KAAK1C,UAAUiB,SAC1BE,EAAImC,EAAOpC,OAAS,KACpBC,EAAI,EAAG,KAAOA,aACX8B,EAAQK,EAAOnC,GAClBoC,EAAM1D,EAAiB2D,WAAWC,KAAKf,KAAMvB,GAC1CuC,EAAST,EAAMU,qBAAqB,SACtCC,EAAIF,EAAOxC,OACR0C,OACCA,GAAGpC,aACT,OACAkC,EAAOE,GAAGrC,aAAa,QAAQE,QAAQiB,KAAK3C,WAAYwD,2CAU5CM,UACRxD,SAASuC,eAAeF,KAAK5C,UAAY+D,6CApDzBvB,OACjBX,EAAQW,EAAEC,OAAOZ,QACrBY,OAAOuB,MAAMC,cAAgBpC,EAAMT,wDAGlBoB,KACjB3B,qBACI4B,EAASD,EAAEC,OACXyB,EAAQzB,EAAO0B,uBAED,MAAhBD,EAAMrC,SACHA,MAAQ,MACPH,aAAa,QAAS,gBACtBgB,WAAWjC,UAAUE,OAAO,cAE7BkB,MAAQ,MACPH,aAAa,QAAS,kBACtBgB,WAAWjC,UAAUC,IAAI,8CA8BfW,EAAG+C,EAAGC,UACjBD,EAAEzC,QAAQ0C,EAAGhD,YAStB4B,OAAOlD,iBAAmBA"}